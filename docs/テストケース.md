# テストケース

## テストファイル構成

| ファイル | テスト数 | 対象 |
|----------|---------|------|
| `src/shared/__tests__/menuConfig.test.ts` | 23 | メニュー設定の値・整合性 |
| `src/shared/__tests__/slotLogic.test.ts` | 22 | スロット生成ロジック |
| `src/data/__tests__/menuData.test.ts` | 7 | メニューデータの整合性・回帰テスト |

---

## TC-1: メニュー設定の値検証 (`menuConfig.test.ts`)

### MENU_CONFIG duration
| ケース | メニュー | 期待値 |
|--------|----------|--------|
| TC-1-1 | standard | 30分 |
| TC-1-2 | premium | 60分 |
| TC-1-3 | family | 120分 |
| TC-1-4 | wedding | 120分 |

### MENU_CONFIG displayName
| ケース | メニュー | 期待値 |
|--------|----------|--------|
| TC-1-5 | standard | 15分撮影プラン |
| TC-1-6 | premium | 30分撮影プラン |
| TC-1-7 | family | 七五三 3歳女の子プラン |
| TC-1-8 | wedding | 七五三 5歳男の子プラン |

### その他
| ケース | 内容 |
|--------|------|
| TC-1-9 | 全メニューキー（standard, premium, family, wedding）が定義されていること |
| TC-1-10 | 全メニューの duration が正の整数であること |

### getMenuDuration()
| ケース | 入力 | 期待値 |
|--------|------|--------|
| TC-1-11〜14 | 各メニュー | MENU_CONFIG の duration と一致 |

---

## TC-2: GASバックエンドとの整合性 (`menuConfig.test.ts`)

| ケース | 内容 |
|--------|------|
| TC-2-1〜4 | `gas/src/types.ts` の各メニュー duration が MENU_CONFIG と一致すること |
| TC-2-5〜8 | `gas/src/types.ts` の各メニュー displayName が MENU_CONFIG と一致すること |

**検証方法**: テスト実行時に `gas/src/types.ts` をファイルシステムから読み取り、正規表現でパース。
フロントエンドとGASバックエンドの設定値乖離を自動検出する。

---

## TC-3: busy期間の重複判定 (`slotLogic.test.ts` — `isSlotBusy`)

busy期間: 13:00〜14:00

| ケース | スロット | 期待値 | 説明 |
|--------|----------|--------|------|
| TC-3-1 | — | false | busy期間なし |
| TC-3-2 | 10:00-11:00 | false | スロットがbusy期間の完全に前 |
| TC-3-3 | 15:00-16:00 | false | スロットがbusy期間の完全に後 |
| TC-3-4 | 13:30-14:30 | true | スロットの開始がbusy期間内 |
| TC-3-5 | 12:30-13:30 | true | スロットの終了がbusy期間内 |
| TC-3-6 | 12:00-15:00 | true | スロットがbusy期間を完全に含む |
| TC-3-7 | 13:15-13:45 | true | busy期間がスロットを完全に含む |
| TC-3-8 | 12:00-13:00 | false | 境界: スロット終了 === busy開始 |
| TC-3-9 | 14:00-15:00 | false | 境界: スロット開始 === busy終了 |
| TC-3-10 | 15:00-15:30 | true | 複数busy期間のうち2番目と重なる |

---

## TC-4: スロット生成 (`slotLogic.test.ts` — `generateDaySlots`)

### busy無し（営業時間 9:00-18:00, 30分間隔）
| ケース | プラン | 期待スロット数 | 最終スロット開始 |
|--------|--------|--------------|----------------|
| TC-4-1 | 30分 | 18 | 17:30 |
| TC-4-2 | 60分 | 17 | 17:00 |
| TC-4-3 | 120分 | 15 | 16:00 |

### 営業時間外はみ出し防止
| ケース | 内容 |
|--------|------|
| TC-4-4 | 120分プラン: 16:30開始スロットが生成されないこと |

### busy期間との重複
| ケース | 条件 | 内容 |
|--------|------|------|
| TC-4-5 | busy 10:00-11:00, 30分プラン | 10:00, 10:30 が unavailable。9:30, 11:00 は available |
| TC-4-6 | busy 10:00-11:00, 120分プラン | 9:00（9:00-11:00）, 9:30（9:30-11:30）も unavailable |
| TC-4-7 | busy 9:00-18:00 | 全スロットが unavailable |

### カスタム営業時間
| ケース | 営業時間 | 間隔 | プラン | 期待スロット数 |
|--------|----------|------|--------|--------------|
| TC-4-8 | 10:00-14:00 | 30分 | 30分 | 8 |
| TC-4-9 | 9:00-18:00 | 60分 | 30分 | 9 |

---

## TC-5: 複数日スロット生成 (`slotLogic.test.ts` — `generateTimeSlotsFromBusyPeriods`)

| ケース | 内容 |
|--------|------|
| TC-5-1 | 1日分の範囲 → generateDaySlots と同一結果 |
| TC-5-2 | 2日分の範囲 → 1日分の2倍のスロット |
| TC-5-3 | busy期間が特定日のみに影響すること（15日の10:00-11:00がbusy → 15日の2スロットのみunavailable） |

---

## TC-6: メニューデータ整合性 (`menuData.test.ts`)

| ケース | 内容 |
|--------|------|
| TC-6-1 | 全 menuOptions の duration が MENU_CONFIG と一致すること |
| TC-6-2 | 全 MENU_CONFIG キーに対応する menuOption が存在すること |
| TC-6-3 | menuOptions に重複した value がないこと |
| TC-6-4 | 全 menuOptions の price が空でないこと |
| TC-6-5 | 全 menuOptions の sections が1つ以上あること |

---

## TC-7: 回帰テスト — バグ再発防止 (`menuData.test.ts`)

| ケース | 内容 | 背景 |
|--------|------|------|
| TC-7-1 | family メニューの duration が 120分であること | GASバックエンドで90分に設定されていたバグの再発防止 |
| TC-7-2 | wedding メニューの duration が 120分であること | 同上 |

---

## 実行方法

```bash
# 全テスト実行
npm test

# ウォッチモード
npm run test:watch
```
